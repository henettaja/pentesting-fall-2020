# Week 3 report

<!-- TOC -->

- [Week 3 report](#week-3-report)
- [The Art of Hacking](#the-art-of-hacking)
    - [Surveying Essential Tools for Active Reconnaissance: Port Scanning and Web Service Review](#4.3-surveying-essential-tools-for-active-reconnaissance-port-scanning-and-web-service-review)
    - [Surveying Essential Tools for Active Reconnaissance: Network and Web Vulnerability Scanners](#4.4-surveying-essential-tools-for-active-reconnaissance-network-and-web-vulnerability-scanners)
- [WebGoat exercises](#webgoat-exercises)
    - [A2 Broken authentication](#a2-broken-authentication)
        - [Authentication bypasses](#authentication-bypasses)
        - [Secure passwords](#secure-passwords)
    - [A3 Sensitive Data Exposure](#a3-sensitive-data-exposure)
    - [A7 Cross Site Scripting](#a7-cross-site-scripting)
        - [What is XSS?](#what-is-xss)
        - [Try It! Reflected XSS](#try-it-reflected-xss)
        - [Identify potential for DOM-Based XSS](#identify-potential-for-dom-based-xss)
        - [Try It! DOM-Based XSS](#try-it-dom-based-xss)

<!-- /TOC -->

# The Art of Hacking

## 4.3 Surveying Essential Tools for Active Reconnaissance: Port Scanning and Web Service Review

- Portti skannaus työkalut
    - nmap
        - Erittäin suosittu, monipuolinen ja vakaa
    - masscan
        - Erittäin nopea, vähemmän monipuolinen kuin nmap
    - UDPProtoScanner
        - Nopea ja tehty nimenomaan UDP porttien skannaamiseen
- Web-palveluiden katselmointi
    - EyeWitness
        - Kätevä, kun tulee skannata suuri määrä web-palveluita ja evaluoida mikä niistä olisi paras kohde

# Nmap Network Scanning

## Chapter 1. Getting Started with Nmap

- Haavoittuvuuksien kartoittaminen
    - Selvitetään kohteen käyttämä IP-osoiteavaruus, saatavilla olevat host-koneet, koneilla olevat palvelut, verkon topologiaan liittyviä yksityksohtia ja minkälaisia palomuuri asetuksia on käytössä

## Port Scanning Basics

- Open
    - Aktiivisesti hyväksyy TCP, UDP tai SCTP yhteyksiä kyseisessä portissa
    - Jokainen avoin portti voi olla väylä hyökätä

- Closed
    - Portti on auki, mutta mikään sovellus ei kuuntele sille tulevaa liikennettä
    - Vastaa siitä huolimatta nmapin lähettämiin paketteihin, joka mahdollistaa joidenkin tietojen paljastamisen host-koneesta (esim. käyttöjärjestelmäversio)

- Filtered
    - Nmap ei pysty määrittämään onko portti auki, koska pakettien suodatus estää nmappia pääsemästä käsiksi porttiin.
    - Tämä voi kuitenkin johtua myös verkon ruuhkaisuudesta, joka pakottaa nmapin kokeilemaan samaa porttia useampaan kertaan varmuuden vuoksi, hidastaen porttiskannausta huomattavasti

## Port Scanning Techniques

- -sS (TCP SYN scan)
    - Oletus ja suosituin skannaus
    - Nopea
    - Verrattain huomaamaton, sillä ei luo kokonaisia TCP-yhteyksiä
    - Kutsutaan myös nimellä "half-open scanning"
- -sT (TCP connect scan)
    - Oletus, kun SYN skannaus ei ole vaihtoehto
    - SYN skannaus yleensä kannattavampi, jos mahdollinen
    - Ottaa kokonaisen TCP-yhteyden kohteeseen
        - Vie enemmän aikaa ja paketteja saada sama määrä tietoa
        - Suurempi todennäköisyys, että kohde tietokoneen logeihin jää tieto yhteydestä
- -sU (UDP scans)
    - Skannaa UDP-portteja
        - UDP-porteissa on palveluita, kuten DNS, SNMP, and DHCP (portit 53, 161/162, and 67/68)
    - Hitaampaa kuin TCP skannaus
        - Mahdollista nopeuttaa skannaamalla useampia hosteja rinnakkain, skannaamalla aluksi vain suositut portit, skannaamalla palomuurin takaa tai skippaamalla hostit joilla kestää kauan vastata
    - Voidaan yhdistää TCP skannauksen kanssa


## 4.4 Surveying Essential Tools for Active Reconnaissance: Network and Web Vulnerability Scanners

- Rikkinäisessä tunnistautumisessa (engl. broken authentication) hyödynnetään aukkoja sovelluksen tunnistautumisjärjestelmässä. Hakkereilla voi olla esimerkiksi listoja valideista käyttäjätunnus ja salasana komboista tai oletus käyttäjätunnuksista ja sen lisäksi voidaan esimerkiksi automaattisesti kirjautua järjestelmään erilaisilla salasanoilla, kunnes oikea löytyy (brute force).

- Järjestelmä on haavoittuvainen edellä mainituilla hyökkäyksille jos se ei osaa tunnistaa ja estää automatisoituja kirjautumisyrityksiä, hyväksyy heikot ja/tai yleiset salasanat, käyttää heikkoja tapoja käyttäjän salasanan palauttamiseen, ei käytä usean vaiheen tunnistautumista, ei säilytä salasanoja vahvan hash-algoritmin suojaamana tai käyttäjäistunnon hallinnointia ei ole toteutettu turvallisesti.

- Hyökkäyksiltä on mahdollista suojautua esimerkiksi usean vaiheen tunnistautumisen käyttöönottamisella ja erilaisten automaattisten kirjautumisyritysten tunnistamisella ja estämisellä.

# WebGoat exercises

## A2 Broken authentication

### Authentication bypasses

- Materiaalin läpiluettua kokeilin täyttää annettuja security questions kenttiä ja lähettää vastaukset ja tutkia minkälainen HTTP pyyntö siitä lähtee palvelimelle selaimen kehittäjäpaneelin "network" välilehteä hyödyntämällä. Sieltä löytyi parametreistä kohdat, jotka sisältävät vastauskenttiin kirjoitetut tiedot. Materiaalissa kerrottiin, että nuo kentät poistamalla on aiemmin päästy ohi näistä turvakysymyksistä, joten kokeilen tehdä juuri niin käyttämällä ZAPia.

Alkuperäinen pyyntö:

``` secQuestion0=Hello&secQuestion1=Hello&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12309746 ```

Omat yritykset:

``` jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12309746 ```

``` secQuestion0=Hello&secQuestion1=Hello&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12345678 ```

``` secQuestion0=true&secQuestion1=true&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12345678 ```

``` secQuestion1=true&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12345678 ```

- Parametrien poistamisesta ei ollut hyötyä ja palvelimen vastaus pyyntöön pysyi samana. Kokeilin myös poistaa kaikki loputkin parametrit, mutta sekään ei tuottanut tulosta vaan palvelin palautti virheen, että se vaatii tiettyjä parametreja. Tässä vaiheessa en keksinyt itse enää muita tapoja ratkaista tehtävää, joten turvauduin googleen ja löysin seuraavan artikkelin, joka käy läpi sisäisesti mitä WebGoat vaatii tehtävän läpäisemiseksi: [WebGoat Authentication Bypass 2](https://pvxs.medium.com/webgoat-authentication-bypass-2-4eeb8e8b502b). WebGoatille täytyy siis antaa parametrit, joiden nimet sisältävät merkkijonon "secQuestion". Näin ollen vaihdoin parametrien nimiksi vain secQuestionA ja secQuestionB ja tehtävä menee läpi. Käytännössä mikä vain menee läpi kunhan parametrien määrä pyynnössä on oikea ja se sisältää parametrin jonka nimessä on secQuestion.

``` secQuestionA=Hello&secQuestionB=Hello&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12309746 ```

- Epäilen, että myös esimerkiksi seuraava toimisi.

``` secQuestionA=Hello&randomParameter=lmao&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=12309746 ```

### Secure passwords

- Tässä kohdassa oli materiaalin lisäksi tehtävän vain kokeilla kenttään 4 eri salasanaa ja katsoa siihen liittyvät tilastot sen turvallisuudesta. Mielenkiintoista.

## A3 Sensitive Data Exposure

Tässä osassa esitettiin tehtävän muodossa, miltä näyttää HTTP kyselyssä cryptaamattomat käyttäjätunnukset. Tunnukset piti saada selville ja käyttää niitä kirjautumisessa. Ratkaisu oli yksinkertaisesti painaa "Login" -painiketta ja etsiä kehittäjätyökalujen "Network" välilehdeltä tätä pyyntöä (tunnistaa metodista "POST") ja tutkia sen sisältämiä parametreja. 

Parametrit:

``` {"username":"CaptainJack","password":"BlackPearl"} ```

## A7 Cross Site Scripting

### What is XSS?

- Ensimmäisessä tehtävässä testattiin kahdella eri välilehdellä WebGoatissa tulostaa document.cookie:n arvo ja tarkistaa onko se sama. Onhan se.

### Try It! Reflected XSS

- Seuraavassa tehtävässä tulee selvittää mitkä ostoskorin syöttökentät ovat haavoittuvaisia cross-site scriptingille. Testasin aluksi kaikki tuotteiden määrää ostoskorissa esittävät kentät. Totesin, että ne vaativat syötteeksi numeron. Tämän jälkeen huomasin, että korttinumero ja CCV koodin kentät hyväksyvät myös tekstiä. Niihin kenttiin kokeilin syöttää JavaScriptiä:

``` alert("lmao") ```

``` alert(document.cookie) ```

- Kummassakaan kokeilussa kenttiin kirjoitettua koodia ei ajettu. WebGoatin vinkeissä kehotetaan katsomaan mitä HTTP pyyntö palauttaa. Mitään muuta oleellista en sieltä löytänyt, mutta vastauksessa lukee, että "Lesson completed: true". Ilmeisesti siis tein jotain oikein, mutta tällä erää jäi epäselväksi mitä. Myöhemmin materiaalissa puhutaan koodin sisällyttämisestä ```<script>alert("xss")</script>``` HTML skriptitägien sisälle. Kokeilin tuota vielä tässä tehtävässä, mutta vieläkään en saanut JavaScriptiä ajettua. Luottokortin numero tosin ei enää tulostunut sivulle sille tarkoitetulla paikalle, joten jotain selvästi tapahtui.

### Identify potential for DOM-Based XSS

- Ymmärsin katsoa kehittäjätyökaluilla mitä JavaScript tiedostoja sivustolla oli, mutta löysin oletettavasti oikean tiedoston (GoatRouter.js) vasta vihjeitä lukemalla. Tästäkään huolimatta en tosin lukuisista erilaisista yrityksistä huolimatta keksi minkälainen polku tehtävään pitää antaa syötteeksi, että se on hyväksyttävä. Kokeiltu on:

``` start.mvc#lesson/WebGoat/js/view/GoatRouter.js ```

``` /WebGoat/start.mvc#lesson/CrossSiteScripting.lesson/9/WebGoat/js/view/GoatRouter.js ```

``` /CrossSiteScripting.lesson/9/WebGoat/js/view/GoatRouter.js ```

``` /WebGoat/js/view/GoatRouter.js ```

- Googlailun jälkeen sain selville, että oikea vastaus on

``` start.mvc#lesson ```

- Tästä päätellen olin ja olen yhä erittäin hukassa sen suhteen mikä tehtävän varsinainen idea oli.

### Try It! DOM-Based XSS

- Lähdin ratkaisemaan tehtävää katsomalla heti ensin vihjeitä, jotta saisin paikattua aukkoja jotka jäi edellisestä tehtävästä. Sieltä selviää, että tuon aiemman tehtävän testiurlin perään voi kirjoittaa tekstiä, joka ilmestyy sitten DOM:iin. Sitä voi siis varmasti käyttää tässä hyväksi, joten kokeilen seuraavia aluksi itselle ja sitten tehtävän vastauskenttään:

``` https://localhost:8080/WebGoat/start.mvc#test/<script>alert("XSS")</script> ```

``` https://localhost:8080/WebGoat/start.mvc#test/<script>webgoat.customjs.phoneHome()</script> ```

- Nämä eivät olleet tehtävän ratkaisu. Kokeilin vielä seuraavaa tehtävän vastaukseksi:

``` start.mvc#test/<script>webgoat.customjs.phoneHome()</script> ```

- Sain vinkkejä lukemalla tietää, että "/" merkin voi korvata merkkijonolla "%2F", jotta se ei mene URL kentässä sekaisin hakemistorakenteella. Tämän tietäen sain alert skriptin ajettua sisältämällä sen URL:iin:

``` https://localhost:8080/WebGoat/start.mvc#test/<script>alert("XSS")<%2Fscript> ```

- Seuraava ei kuitenkaan triggeröi haluttua skriptiä: 

``` https://localhost:8080/WebGoat/start.mvc#test/<script>webgoat.customjs.phoneHome()<%2Fscript> ```

- Jonkun aikaa kun olin ihmetellyt ja kokeilin tuota samaa urlia toisessa välilehdessä niin sainkin tuon skriptin ajettua ja tehtävän ratkaistua. En tiedä miksei tuo URL aluksi toiminut.